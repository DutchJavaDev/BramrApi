using System.IO;
using System;
using System.Text;

namespace PlayGround
{
    class Program
    {
        static void Main(string[] args)
        {
            var fileName = "config.txt";

            var fileContents = File.ReadAllText(fileName);

            var contents = fileContents.Split("\n");

            var mainBlock = new StringBuilder();

            foreach (var line in contents)
            {
                mainBlock.AppendLine(line.Trim());
            }

            var block = FindServerBlock("boris_website", contents, mainBlock);

            Console.WriteLine(block);

            //var nblock = CreateServerBlock("boris_website", "home");

            //Console.WriteLine(mainBlock.ToString());
            //Console.WriteLine("##########");
            //var nnn = mainBlock.ToString().Replace("#next_block", nblock);
            //Console.WriteLine(nnn);
            //File.WriteAllText(fileName, nnn);
        }

        private static string FindServerBlock(string name, string[] lines, StringBuilder trimmedFile)
        {
            var start = $"#start_{name}";
            var end = $"#end_{name}";

            var contents = lines;
            var builder = new StringBuilder();
            var contentBuilder = trimmedFile;
            var lineCount = contents.Length;
            var count = 0;
            var startLine = -1;
            var endLine = -1;

            while (count != lineCount)
            {
                if (startLine == -1 && contents[count].Contains(start))
                {
                    startLine = count;
                }

                if (startLine > 1 && endLine == -1 && contents[count].Contains(end))
                {
                    endLine = count;
                }

                if (startLine > 0 && endLine > 0)
                    break;

                count++;
            }

            for (var i = startLine; i <= endLine; i++)
            {
                builder.AppendLine(contents[i].Trim());
            }

            return builder.ToString();
        }

        private static string CreateServerBlock(string url, string alias)
        {
            var builder = new StringBuilder();

            var lines = File.ReadAllLines("template.txt");

            foreach (var line in lines)
            {
                builder.AppendLine(line.Replace("[URL]", url).Replace("[ALIAS]", alias));
            }

            builder.AppendLine("#next_block\n");

            return builder.ToString();             
        }
    }
}
